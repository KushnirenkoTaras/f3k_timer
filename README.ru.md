# f3k_timer
Таймер предназначен для хронометрирования полетов на DLG планерах. Позволяет сохранить до 30 результатов в виде списка.

## Схема подключений
| Arduino NANO | TFT 1.8' |
| --- | --- |
| PIN 08 | A0 |
| PIN 09 | RES |
| PIN 10 | CS |
| PIN 11 | SOA |
| PIN 13 | SCK |
| PIN 3v3 | LED |

| Устр-во | +5V | GND |
| --- | --- | --- |
| Arduino | VCC | GND |
| TFT 1.8' | VCC | GND |

| Arduino NANO | Устр-во | Примечание |
| --- | --- | --- |
| PIN A0 | + 1S battery | Voltage detect |
| PIN A1 | Кнопка Start/Stop | |
| PIN A2 | Кнопка List/Reset | |
| PIN 07 | Пъезодинамик + | |

## Используемые библиотеки
* \<SPI\>
* \<Adafruit_GFX\>
* \"TFT_ST7735\" Настройки для дисплея [TFTLCD-SPI1.44](http://www.kosmodrom.com.ua/el.php?name=TFTLCD-SPI1.44) в директории _setting
* \<VoltageReference.h\>
* \<OneButton.h\>
* \<EEPROM.h\>

## Функции кнопок
### Start/Stop (правая кнопка)
* Нажатие - Start/Stop секундомера
* Длительное нажатие - только при остановленном таймере. Одновременно с кнопкой  List/Reset - переход в режим **Setup**

### List/Reset (левая кнопка) - доступна только при остановленном таймере
* Нажатие - листать страницы результатов. По 5 строк на страницу. Макс. 30 результатов.
* Длительное нажатие - очистить список результатов

## Setup меню
Войти в меню Setup возможно только при остановленном таймере. Вход - длительное одновременное нажатие обеих кнопок.

В меню текущий пункт отмечен символом ">".

* Start/Stop - следующий пункт меню     
* List/Reset - предыдущий пункт меню     

Длительное нажатие Start/Stop - вход в режим редактирования пункта меню. В режиме редактирования пункт меню отмечен "*".

Выход из режима редактирования - длительное нажатие любой кнопки.

### Меню *Setup*
* **Exit**    - Выйти из установок без сохранения изменений параметров в EEPROM памяти.
* **Save**    - Выйти из установок и сохранить изменения параметров в EEPROM памяти.
* **Restore** - Выйти из установок и восстановить параметры.
* **Default** - Выйти из установок и установить значения параметров по умолчанию.

### Меню *Color*
* **Backgr**  - Выбор цвета фона. По умолчанию черный. Помните - красный, желтый и зеленый используются для индикатора заряда батареи
* **Timer**   - Выбор цвета цифр секундомера. По умолчанию белый.
* **Result**  - Выбор цвета списка результатов. По умолчанию желтый.

### Меню *Tone*
* **Start**   - Тон для старта секундомера. Нота C5 (523 Hz) по умолчанию
* **Stop**    - Тон для остановки секундомера. Нота C6 (1047 Hz) по умолчанию
* **15 sec**  - Тон для 15 секундого сигнала. Нота C7 (2093 Hz) по умолчанию
* **Minute**  - Тон для поминутного сигнала. Нота C8 (4186 Hz) по умолчанию

### Меню *Batt*
* **Off**     - Напряжение низкое в sV. По умолчанию 300 (3.00 V)
* **Crit**    - Напряжение критично в sV. По умолчанию 350 (3.50 V)
* **Warn**    - Напряжение внимание в sV. По умолчанию 380 (3.80 V)

### Меню *Time*
* **Corr**    - Коррекция таймера. По умолчанию 0
* **Start**   - Продолжительность сигнала Start/Stop в ms. По умолчанию 200 (0.2 sec)
* **Beep**    - Продолжительность 15 сек/поминутного сигнала в ms. По умолчанию 70 (0.07 sec). Если 0 - 15 сек сигнал выключен

## Коррекция таймера
Так как тактовая частота микроконтроллера может отличаться в зависимости от экземпляра, секундомер может спешить или отставать. Для коректировки этого используется параметр **Corr** меню *Time*.

В этом параметре необходимо указать на сколько уходит время за 1 минуту в ms. Методика расчета этого параметра следующая:
* запустить таймер одновременно с секундомером. Например спортивным
* засечь время не менее 10 мин, лучше 30 мин для более точного вычисления.
* сравниваем время. Например, таймер ушел вперед на 0.6 секунд за 30 минут
* 0.6 = 600 ms. 600 / 30 = 20. Вводим параметр **Corr** = 20.
* Если таймер отстает - задаем параметр **Corr** зо знаком минус

